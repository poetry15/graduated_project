<!--https://liff.line.me/2004358826-B27pRRmy-->
<!DOCTYPE html>
<html>
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>情緒填寫</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
	<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<script src="https://unpkg.com/vconsole@latest/dist/vconsole.min.js"></script>
	
	<script>
	// VConsole will be exported to `window.VConsole` by default.
	var vConsole = new window.VConsole();
	</script>
	<link rel="stylesheet" href="static/style.css">
	
	<script src="../config.js"></script>
	<!-- <link rel="stylesheet" href="{% static 'style.css' %}"> -->
</head>
<body>
    <!-- <p>User ID:<span id="userId"></span></p>
    <p id="result">這裡是掃到的結果</p> -->

    <p style="height: 10px;"></p>
    <div class="container mt-3">
        <p>你現在的感受如何呢?</p>
        <span id="MoodText">情緒中性</span>

        <div id="form1" style="display: block;"> <!-- 表單第一頁 -->
            <input type="range" min="0" max="100" value="50" id="customRange" step="1" name="points">
            <p id="test"></p>
            <label for="customRange" class="form-label">請先選擇你覺得與你狀態符合的關鍵詞</label>
            <div id="moodButtonsContainer"></div>
            <p> </p>
            <button id="toggle-button" class="btn btn-secondary"></button>
            <p> </p>
            
            <button id="nextstep" class="btn btn-secondary btn-sm" style="float:right; margin-right: 5px; margin-top: -20px;" onclick="nextstep()">下一步 ></button> <!-- 按鈕置右 -->
        </div>

        <div id="form2" style="display: none;"> <!-- 表單第二頁 -->
            <div id ="MoodTextArea">
                <p></p>
                <label class="form-label">說說你的感受吧！選擇影響你最大的原因</label>
                <div id="EmotionFactorsContainer"></div>
                <p> </p>
                <p>能多跟我分享分享嗎? 關鍵字或是完整事件都可以</p>
                <!-- 提示文字半透明，輸入文字則正常 -->
                <textarea id="Text" placeholder="請說說你的感受... (可多獲得骰子)" style="opacity: 0.7;" onfocus="this.style.opacity='1';" onblur="this.style.opacity='0.5';"></textarea>
                <p> </p>
                <button id="prevstep" class="btn btn-secondary btn-sm" style="margin-left: 2%; " onclick="previousstep()"> < 上一步</button> <!-- 按鈕置左 -->
                <button class="btn btn-secondary btn-sm" style="float:right; width: 60px;" id="submit"> 完成 </button>
            </div>
            
        </div>
    </div>
	<script src="static/test.js"></script>
	<script>
		// 維修 liff init 方法來自：https://narongdej.dev/blog/th/2024/04/04/%E0%B8%A7%E0%B8%B4%E0%B8%98%E0%B8%B5%E0%B9%81%E0%B8%81%E0%B9%89-type-error-failed-to-fetch-%E0%B9%83%E0%B8%99-line-liff-android
		// 保存原始的 fetch 函數
		const originalFetch = window.fetch;

		// 自定義的 fetch 函數
		function customFetch(URL, options) {
			// 確保 URL 是字符串
			if (typeof URL === 'object' && URL !== null)
				URL = URL.toString();
			// 檢查 URL 是否符合條件
			if (URL.startsWith('https://liffsdk.line-scdn.net/xlt/') && URL.endsWith('.json'))
				URL = URL + '?ts=' + Math.random();

			// 調用原始的 fetch 函數
			return originalFetch(URL, options);
		}
		// 替換 window.fetch 為自定義的 fetch 函數
		window.fetch = customFetch;

		function triggerLIFF() {
			let liffID = "2004371526-pRAP9QZY";
			// LIFF init
			liff.init({
				liffId: liffID
			})
			.then(() => {
				if (!liff.isLoggedIn()) { // 登入
					liff.login();
					return;
				}
				console.log("login: " + liff.isLoggedIn());
				return liff.getProfile();
			})
			.then(profile => { // 確認可以抓取userid
				userId = profile.userId;
				// document.getElementById('userId').textContent = userId;
			})
			.then(() => {
				checkfivemin();
				scancode();
			})
			.catch(function(error) {
				alert(error);
			});
		}
		
		window.onload = function(){
			triggerLIFF();
		}
		
		console.log("載入完成~~");
	</script>
</body>
</html>

